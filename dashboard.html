<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CampusSpace Dashboard</title>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<link rel="stylesheet" href="style.css" />
<style>
/* ----------------- Body & Header ----------------- */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(145deg, #f4f4f4, #eaeaea);
  margin: 0;
  color: #222;
  transition: background 0.3s ease;
}

header {
  background: linear-gradient(90deg, #b31b1b, #ff2c2c);
  color: #fff;
  text-align: center;
  padding: 25px 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
header h1 { margin-bottom: 5px; font-size: 2rem; letter-spacing: 1px; }

/* ----------------- Main Buttons ----------------- */
main.dashboard { text-align: center; margin-top: 30px; }
.choice-buttons { margin-top: 20px; display: flex; justify-content:center; gap:20px; flex-wrap:wrap; }
.btn {
  background: linear-gradient(135deg, #b31b1b, #ff2c2c);
  color: white;
  border: none;
  padding: 15px 30px;
  margin: 10px;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
}
.btn:hover { transform: scale(1.08); box-shadow: 0 8px 20px rgba(0,0,0,0.3); background: linear-gradient(135deg,#ff2c2c,#b31b1b); }

/* ----------------- Sections ----------------- */
section {
  max-width: 950px;
  margin: 30px auto;
  padding: 20px;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}
section:hover { transform: translateY(-5px); }

/* ----------------- Map ----------------- */
#map-room, #map-outlet {
  height: 500px;
  border-radius: 15px;
  box-shadow: 0 8px 15px rgba(0,0,0,0.2);
  transition: transform 0.3s;
}
#map-room:hover, #map-outlet:hover { transform: scale(1.01); }

/* ----------------- Dropdown Panel with Floors ----------------- */
.dropdown-panel {
  position: fixed;
  bottom: -500px;
  left: 0;
  width: 100%;
  max-height: 500px;
  background: rgba(26,26,26,0.97);
  backdrop-filter: blur(10px);
  box-shadow: 0 -6px 20px rgba(0,0,0,0.5);
  border-top: 3px solid #ff2c2c;
  overflow-y: auto;
  color: white;
  transition: bottom 0.4s ease;
  z-index: 999;
  padding: 25px;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
}
.dropdown-panel.show { bottom: 0; }
.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
.panel-header h3 {
  margin: 0;
  color: #ffcc00;
  font-size: 1.5rem;
  letter-spacing: 0.5px;
}
.close-panel {
  background: #b31b1b;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s;
}
.close-panel:hover { background: #ff2c2c; }
.panel-summary {
  background: rgba(255, 255, 255, 0.1);
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-around;
  text-align: center;
}
.summary-stat {
  flex: 1;
}
.summary-stat .number {
  font-size: 2rem;
  font-weight: bold;
  color: #4caf50;
}
.summary-stat.occupied .number {
  color: #ff2c2c;
}
.summary-stat .label {
  font-size: 0.9rem;
  color: #ccc;
  margin-top: 5px;
}
.floor-section {
  margin-bottom: 25px;
}
.floor-title {
  font-size: 1.2rem;
  color: #ff2c2c;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 2px solid rgba(255, 44, 44, 0.3);
}
.room-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}
.room-card {
  background: linear-gradient(135deg, rgba(179, 27, 27, 0.3), rgba(255, 44, 44, 0.3));
  padding: 15px;
  border-radius: 10px;
  border-left: 4px solid #4caf50;
  transition: transform 0.3s, box-shadow 0.3s;
  cursor: pointer;
}
.room-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(255, 44, 44, 0.4);
}
.room-card.occupied {
  border-left-color: #ff2c2c;
  opacity: 0.7;
}
.room-card.available {
  border-left-color: #4caf50;
}
.room-name {
  font-size: 1.1rem;
  font-weight: bold;
  margin-bottom: 8px;
}
.room-status {
  font-size: 0.9rem;
  margin-bottom: 5px;
}
.room-status .badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: bold;
}
.badge.available {
  background: #4caf50;
  color: white;
}
.badge.occupied {
  background: #ff2c2c;
  color: white;
}
.room-time {
  font-size: 0.85rem;
  color: #aaa;
  margin-top: 5px;
}
.no-rooms {
  text-align: center;
  padding: 30px;
  color: #888;
  font-style: italic;
}

/* ----------------- Footer ----------------- */
footer {
  text-align: center;
  padding: 20px 0;
  margin-top: 40px;
  background: linear-gradient(90deg,#000,#222);
  color: #fff;
  border-top: 2px solid #b31b1b;
  box-shadow: 0 -3px 10px rgba(0,0,0,0.3);
}
</style>
</head>

<body>
<header>
  <h1>CampusSpace Dashboard</h1>
  <p id="welcomeText"></p>
</header>

<main class="dashboard">
  <h2>What are you looking for?</h2>
  <div class="choice-buttons">
    <button class="btn" onclick="showSection('room')">Find Classroom</button>
    <button class="btn" onclick="showSection('outlet')">Find Outlet</button>
  </div>
</main>

<section id="room-section" style="display:none;">
  <h3 style="text-align:center;">Classroom Locations</h3>
  
  <!-- Filter Controls -->
  <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center; justify-content: center;">
      <div>
        <label style="font-weight: bold; margin-right: 8px;">üîç Filter:</label>
        <select id="availability-filter" onchange="applyFilters()" style="padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
          <option value="all">All Rooms</option>
          <option value="available">üü¢ Available Only</option>
          <option value="occupied">üî¥ Occupied Only</option>
        </select>
      </div>
      
      <div>
        <label style="font-weight: bold; margin-right: 8px;">üè¢ Building:</label>
        <select id="building-filter" onchange="applyFilters()" style="padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
          <option value="all">All Buildings</option>
        </select>
      </div>
      
      <div>
        <label style="font-weight: bold; margin-right: 8px;">üìÖ Time:</label>
        <select id="time-filter" onchange="applyFilters()" style="padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
          <option value="now">Available Now</option>
          <option value="1hour">In 1 Hour</option>
          <option value="2hour">In 2 Hours</option>
          <option value="today">All Day</option>
        </select>
      </div>
      
      <button onclick="clearFilters()" style="background: #666; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
        Clear Filters
      </button>
      
      <button onclick="showAllRoomsView()" style="background: #b31b1b; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
        üìã List View
      </button>
    </div>
    
    <div id="filter-results" style="margin-top: 15px; text-align: center; font-weight: bold; color: #b31b1b;">
    </div>
  </div>
  
  <div id="map-room"></div>
</section>

<section id="outlet-section" style="display:none;">
  <h3 style="text-align:center;">Outlet Locations</h3>
  <div id="map-outlet"></div>
</section>

<div id="dropdown-panel" class="dropdown-panel">
  <div class="panel-header">
    <h3 id="panel-title"></h3>
    <button class="close-panel" onclick="closePanel()">‚úï Close</button>
  </div>
  <div id="panel-summary" class="panel-summary" style="display:none;">
    <div class="summary-stat available">
      <div class="number" id="available-count">0</div>
      <div class="label">Available</div>
    </div>
    <div class="summary-stat occupied">
      <div class="number" id="occupied-count">0</div>
      <div class="label">Occupied</div>
    </div>
    <div class="summary-stat">
      <div class="number" id="total-count">0</div>
      <div class="label">Total Rooms</div>
    </div>
  </div>
  <div id="panel-content"></div>
</div>

<footer>
  <p>¬© 2025 CampusSpace | Built for students, by students</p>
</footer>

<script src="api-client.js"></script>
<script>
// --- LOGIN ---
const njitId = localStorage.getItem("njitId");
const welcomeText = document.getElementById("welcomeText");
if (!njitId) window.location.href = "index.html";
else welcomeText.textContent = `Welcome, ${njitId}!`;

// --- Section switch ---
function showSection(type){
  document.getElementById("room-section").style.display = "none";
  document.getElementById("outlet-section").style.display = "none";
  closePanel();

  if(type === "room"){
    document.getElementById("room-section").style.display = "block";
    if(!window.roomMap) initRoomMap();
  } else {
    document.getElementById("outlet-section").style.display = "block";
    if(!window.outletMap) initOutletMap();
  }
}

// Building coordinates
const buildingCoords = {
  "Campus Center":[40.74306293183706,-74.1782790746367],
  "CKB":[40.742077930044374,-74.17761165873084],
  "Tiernan":[40.74211389580971,-74.17960771474273],
  "FMH":[40.74194824823075,-74.17886430626339],
  "ECE":[40.74148403914861,-74.17876516412794],
  "NJIT Bookstore":[40.74122061658114,-74.1780857575864],
  "Fenster":[40.74259903233696,-74.1772116993912],
  "Eberhardt Hall":[40.74282548216093,-74.17710341553955],
  "Cullimore Hall":[40.742999783794815,-74.17736955981962],
  "Kupfrian":[40.742497611819225,-74.17854209440154],
  "NJIT Library":[40.74386467796301,-74.17809100239326],
  "GITC":[40.74427820993796,-74.17930669533548],
  "WEC":[40.74226698922005,-74.1803714183182]
};

// Real-time classroom and outlet data
let classroomList = {};
let outletList = {
  "Campus Center":["2nd Floor Lounge","Game Room"],
  "Central King Building":["Hallway Outlet"],
  "GITC":["Atrium Outlet"],
  "Library":["Study Zone Outlet"]
};
let roomAvailabilityData = {};
let allRoomsData = [];
let currentFilters = {
  availability: 'all',
  building: 'all',
  time: 'now'
};

// Load real classroom data from backend
async function loadRoomData() {
  try {
    const result = await CampusSpaceAPI.getRoomAvailability();
    if (result.success) {
      roomAvailabilityData = result;
      allRoomsData = [...result.availableRooms, ...result.occupiedRooms];
      
      // Group rooms by building
      classroomList = {};
      
      allRoomsData.forEach(room => {
        const building = room.room.split(' ')[0]; // Extract building code
        if (!classroomList[building]) {
          classroomList[building] = [];
        }
        
        const status = room.isAvailable ? 'üü¢ Available' : 'üî¥ Occupied';
        const nextInfo = room.nextClass ? ` (Next: ${room.nextClass.startTime})` : '';
        classroomList[building].push(`${room.room} - ${status}${nextInfo}`);
      });
      
      // Populate building filter dropdown
      populateBuildingFilter();
      
      console.log('‚úÖ Loaded room data:', result.summary);
      updateFilterResults();
    }
  } catch (error) {
    console.error('Error loading room data:', error);
  }
}

// Populate building filter dropdown
function populateBuildingFilter() {
  const buildingFilter = document.getElementById('building-filter');
  if (!buildingFilter) return;
  
  const buildings = new Set();
  allRoomsData.forEach(room => {
    const building = room.room.split(' ')[0];
    buildings.add(building);
  });
  
  // Clear existing options except "All Buildings"
  buildingFilter.innerHTML = '<option value="all">All Buildings</option>';
  
  // Add building options
  Array.from(buildings).sort().forEach(building => {
    const option = document.createElement('option');
    option.value = building;
    option.textContent = building;
    buildingFilter.appendChild(option);
  });
}

// Apply filters
function applyFilters() {
  const availabilityFilter = document.getElementById('availability-filter');
  const buildingFilter = document.getElementById('building-filter');
  const timeFilter = document.getElementById('time-filter');
  
  if (availabilityFilter) currentFilters.availability = availabilityFilter.value;
  if (buildingFilter) currentFilters.building = buildingFilter.value;
  if (timeFilter) currentFilters.time = timeFilter.value;
  
  updateFilterResults();
}

// Clear filters
function clearFilters() {
  currentFilters = { availability: 'all', building: 'all', time: 'now' };
  
  const availabilityFilter = document.getElementById('availability-filter');
  const buildingFilter = document.getElementById('building-filter');
  const timeFilter = document.getElementById('time-filter');
  
  if (availabilityFilter) availabilityFilter.value = 'all';
  if (buildingFilter) buildingFilter.value = 'all';
  if (timeFilter) timeFilter.value = 'now';
  
  updateFilterResults();
}

// Update filter results display
function updateFilterResults() {
  const filterResults = document.getElementById('filter-results');
  if (!filterResults) return;
  
  let filteredRooms = allRoomsData.filter(room => {
    // Availability filter
    if (currentFilters.availability === 'available' && !room.isAvailable) return false;
    if (currentFilters.availability === 'occupied' && room.isAvailable) return false;
    
    // Building filter
    if (currentFilters.building !== 'all') {
      const building = room.room.split(' ')[0];
      if (building !== currentFilters.building) return false;
    }
    
    return true;
  });
  
  const availableCount = filteredRooms.filter(r => r.isAvailable).length;
  const occupiedCount = filteredRooms.filter(r => !r.isAvailable).length;
  
  filterResults.innerHTML = `
    Showing ${filteredRooms.length} rooms: 
    <span style="color: #4caf50;">üü¢ ${availableCount} Available</span> | 
    <span style="color: #ff2c2c;">üî¥ ${occupiedCount} Occupied</span>
  `;
}

// Show all rooms in a list view
function showAllRoomsView() {
  let filteredRooms = allRoomsData.filter(room => {
    if (currentFilters.availability === 'available' && !room.isAvailable) return false;
    if (currentFilters.availability === 'occupied' && room.isAvailable) return false;
    
    if (currentFilters.building !== 'all') {
      const building = room.room.split(' ')[0];
      if (building !== currentFilters.building) return false;
    }
    
    return true;
  });
  
  // Group by building
  const byBuilding = {};
  filteredRooms.forEach(room => {
    const building = room.room.split(' ')[0];
    if (!byBuilding[building]) byBuilding[building] = [];
    byBuilding[building].push(room);
  });
  
  const panel = document.getElementById("dropdown-panel");
  const panelTitle = document.getElementById("panel-title");
  const panelContent = document.getElementById("panel-content");
  const panelSummary = document.getElementById("panel-summary");

  panelTitle.textContent = "All Classrooms";
  panelSummary.style.display = "flex";
  
  const availableCount = filteredRooms.filter(r => r.isAvailable).length;
  const occupiedCount = filteredRooms.filter(r => !r.isAvailable).length;
  document.getElementById('available-count').textContent = availableCount;
  document.getElementById('occupied-count').textContent = occupiedCount;
  document.getElementById('total-count').textContent = filteredRooms.length;
  
  panelContent.innerHTML = "";
  
  Object.keys(byBuilding).sort().forEach(building => {
    const buildingSection = document.createElement('div');
    buildingSection.className = 'floor-section';
    
    const buildingTitle = document.createElement('div');
    buildingTitle.className = 'floor-title';
    const availInBuilding = byBuilding[building].filter(r => r.isAvailable).length;
    buildingTitle.textContent = `${building} (${availInBuilding}/${byBuilding[building].length} available)`;
    buildingSection.appendChild(buildingTitle);
    
    const roomGrid = document.createElement('div');
    roomGrid.className = 'room-grid';
    
    byBuilding[building].sort((a, b) => a.room.localeCompare(b.room)).forEach(room => {
      const card = document.createElement('div');
      card.className = `room-card ${room.isAvailable ? 'available' : 'occupied'}`;
      
      let statusHtml = `<span class="badge ${room.isAvailable ? 'available' : 'occupied'}">
                        ${room.isAvailable ? 'üü¢ Available' : 'üî¥ Occupied'}
                      </span>`;
      
      let timeHtml = '';
      if (room.isAvailable && room.nextClass) {
        timeHtml = `<div class="room-time">Next: ${room.nextClass.startTime}</div>`;
      } else if (!room.isAvailable && room.currentClass) {
        timeHtml = `<div class="room-time">Until: ${room.currentClass.times.split(' - ')[1]}</div>`;
      }

      card.innerHTML = `
        <div class="room-name">${room.room}</div>
        <div class="room-status">${statusHtml}</div>
        ${timeHtml}
      `;
      
      roomGrid.appendChild(card);
    });
    
    buildingSection.appendChild(roomGrid);
    panelContent.appendChild(buildingSection);
  });
  
  panel.classList.add("show");
}

// Auto-refresh room data every 5 minutes
loadRoomData();
setInterval(loadRoomData, 5 * 60 * 1000);

// Dropdown panel - Enhanced with floors and availability
async function showBuildingInfo(building, type) {
  const map = (type === "room") ? window.roomMap : window.outletMap;
  map.setView(buildingCoords[building], 18);

  const panel = document.getElementById("dropdown-panel");
  const panelTitle = document.getElementById("panel-title");
  const panelContent = document.getElementById("panel-content");
  const panelSummary = document.getElementById("panel-summary");

  panelTitle.textContent = building;
  panelContent.innerHTML = "";

  if (type === "room") {
    // Show room availability with floors
    panelSummary.style.display = "flex";
    
    // Get rooms for this building from API
    const buildingCode = getBuildingCode(building);
    const buildingRooms = Object.values(roomAvailabilityData.availableRooms || [])
      .concat(Object.values(roomAvailabilityData.occupiedRooms || []))
      .filter(room => room.room.startsWith(buildingCode));

    if (buildingRooms.length === 0) {
      // Fallback to classroomList
      const items = classroomList[buildingCode] || classroomList[building] || [];
      if (items.length === 0) {
        panelContent.innerHTML = '<div class="no-rooms">No room data available for this building</div>';
      } else {
        // Simple list view
        const roomGrid = document.createElement('div');
        roomGrid.className = 'room-grid';
        items.forEach(item => {
          const card = document.createElement('div');
          card.className = 'room-card';
          card.innerHTML = `<div class="room-name">${item}</div>`;
          roomGrid.appendChild(card);
        });
        panelContent.appendChild(roomGrid);
      }
    } else {
      // Organize rooms by floor
      const floors = {};
      buildingRooms.forEach(room => {
        const roomNum = room.room.split(' ')[1] || '???';
        const floor = roomNum.charAt(0) || 'Unknown'; // First digit is floor
        
        if (!floors[floor]) {
          floors[floor] = { available: [], occupied: [] };
        }
        
        if (room.isAvailable) {
          floors[floor].available.push(room);
        } else {
          floors[floor].occupied.push(room);
        }
      });

      // Update summary
      const availableCount = buildingRooms.filter(r => r.isAvailable).length;
      const occupiedCount = buildingRooms.filter(r => !r.isAvailable).length;
      document.getElementById('available-count').textContent = availableCount;
      document.getElementById('occupied-count').textContent = occupiedCount;
      document.getElementById('total-count').textContent = buildingRooms.length;

      // Display floors
      const sortedFloors = Object.keys(floors).sort();
      sortedFloors.forEach(floorNum => {
        const floorSection = document.createElement('div');
        floorSection.className = 'floor-section';
        
        const floorTitle = document.createElement('div');
        floorTitle.className = 'floor-title';
        const floorName = floorNum === '0' ? 'Ground Floor' : 
                         floorNum === '1' ? '1st Floor' :
                         floorNum === '2' ? '2nd Floor' :
                         floorNum === '3' ? '3rd Floor' :
                         `${floorNum}th Floor`;
        const totalOnFloor = floors[floorNum].available.length + floors[floorNum].occupied.length;
        floorTitle.textContent = `${floorName} (${floors[floorNum].available.length}/${totalOnFloor} available)`;
        floorSection.appendChild(floorTitle);

        const roomGrid = document.createElement('div');
        roomGrid.className = 'room-grid';

        // Show available rooms first
        [...floors[floorNum].available, ...floors[floorNum].occupied].forEach(room => {
          const card = document.createElement('div');
          card.className = `room-card ${room.isAvailable ? 'available' : 'occupied'}`;
          
          let statusHtml = `<span class="badge ${room.isAvailable ? 'available' : 'occupied'}">
                            ${room.isAvailable ? 'üü¢ Available' : 'üî¥ Occupied'}
                          </span>`;
          
          let timeHtml = '';
          if (room.isAvailable && room.nextClass) {
            timeHtml = `<div class="room-time">Next: ${room.nextClass.startTime}</div>`;
          } else if (!room.isAvailable && room.currentClass) {
            timeHtml = `<div class="room-time">Until: ${room.currentClass.times.split(' - ')[1]}</div>`;
          }

          card.innerHTML = `
            <div class="room-name">${room.room}</div>
            <div class="room-status">${statusHtml}</div>
            ${timeHtml}
          `;
          
          roomGrid.appendChild(card);
        });

        floorSection.appendChild(roomGrid);
        panelContent.appendChild(floorSection);
      });
    }
  } else {
    // Outlet view
    panelSummary.style.display = "none";
    const items = outletList[building] || [];
    
    if (items.length === 0) {
      panelContent.innerHTML = '<div class="no-rooms">No outlet data available for this building</div>';
    } else {
      const roomGrid = document.createElement('div');
      roomGrid.className = 'room-grid';
      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'room-card available';
        card.innerHTML = `
          <div class="room-name">‚ö° ${item}</div>
          <div class="room-status"><span class="badge available">Available</span></div>
        `;
        roomGrid.appendChild(card);
      });
      panelContent.appendChild(roomGrid);
    }
  }

  panel.classList.add("show");
}

// Helper function to get building code
function getBuildingCode(buildingName) {
  const mappings = {
    "Kupfrian": "KUPF",
    "Campus Center": "CC",
    "Central King Building": "CKB",
    "Tiernan": "Tiernan",
    "FMH": "FMH",
    "ECE": "ECE",
    "NJIT Bookstore": "Store",
    "Fenster": "Fenster",
    "Eberhardt Hall": "Eberhardt",
    "Cullimore Hall": "Cullimore",
    "NJIT Library": "Library",
    "GITC": "GITC",
    "WEC": "WEC"
  };
  return mappings[buildingName] || buildingName.split(' ')[0];
}
function closePanel(){ document.getElementById("dropdown-panel").classList.remove("show"); }

// Initialize maps
function initRoomMap(){
  window.roomMap = L.map("map-room").setView([40.7428,-74.1785],17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom:19, attribution:'¬© OpenStreetMap'
  }).addTo(window.roomMap);

  Object.entries(buildingCoords).forEach(([name, coord])=>{
    L.marker(coord,{
      icon:L.icon({
        iconUrl:'https://cdn-icons-png.flaticon.com/512/167/167707.png',
        iconSize:[30,30]
      })
    }).addTo(window.roomMap).bindPopup(`<b>${name}</b>`)
      .on("click",()=>showBuildingInfo(name,"room"));
  });
}

// Custom inline SVG plug icon (DivIcon) in blue
function makePlugIcon(size = 35, color = "#1e90ff"){ // Dodger Blue
  const half = Math.round(size/2);
  return L.divIcon({
    html: `
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <!-- Minimal plug: two prongs + body -->
        <g fill="${color}">
          <rect x="6" y="2" width="3" height="7" rx="1.5"></rect>
          <rect x="15" y="2" width="3" height="7" rx="1.5"></rect>
          <rect x="5" y="9" width="14" height="9" rx="3"></rect>
          <!-- Cable nub -->
          <rect x="10.5" y="18" width="3" height="4" rx="1.2"></rect>
        </g>
        <!-- Subtle outline for contrast -->
        <rect x="5" y="9" width="14" height="9" rx="3" fill="none" stroke="#0f3d99" stroke-width="0.8"></rect>
      </svg>
    `,
    className: "plug-icon",
    iconSize: [size, size],
    iconAnchor: [half, size],     // bottom center
    popupAnchor: [0, -size]       // popup above icon
  });
}

function initOutletMap(){
  const outletIcon = makePlugIcon(35, "#1e90ff");

  window.outletMap = L.map("map-outlet").setView([40.7428,-74.1785],17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom:19, attribution:'¬© OpenStreetMap'
  }).addTo(window.outletMap);

  Object.entries(buildingCoords).forEach(([name, coord])=>{
    L.marker(coord,{ icon: outletIcon })
      .addTo(window.outletMap).bindPopup(`<b>${name}</b>`)
      .on("click",()=>showBuildingInfo(name,"outlet"));
  });
}
</script>
</body>
</html>