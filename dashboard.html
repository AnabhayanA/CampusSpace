<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CampusSpace Dashboard</title>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<link rel="stylesheet" href="style.css" />
<style>
/* ----------------- Body & Header ----------------- */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(145deg, #f4f4f4, #eaeaea);
  margin: 0;
  color: #222;
  transition: background 0.3s ease;
}

header {
  background: linear-gradient(90deg, #b31b1b, #ff2c2c);
  color: #fff;
  text-align: center;
  padding: 25px 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
header h1 { margin-bottom: 5px; font-size: 2rem; letter-spacing: 1px; }

/* ----------------- Main Buttons ----------------- */
main.dashboard { text-align: center; margin-top: 30px; }
.choice-buttons { margin-top: 20px; display: flex; justify-content:center; gap:20px; flex-wrap:wrap; }
.btn {
  background: linear-gradient(135deg, #b31b1b, #ff2c2c);
  color: white;
  border: none;
  padding: 15px 30px;
  margin: 10px;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
}
.btn:hover { transform: scale(1.08); box-shadow: 0 8px 20px rgba(0,0,0,0.3); background: linear-gradient(135deg,#ff2c2c,#b31b1b); }

/* ----------------- Sections ----------------- */
section {
  max-width: 950px;
  margin: 30px auto;
  padding: 20px;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}
section:hover { transform: translateY(-5px); }

/* ----------------- Map ----------------- */
#map-room, #map-outlet {
  height: 500px;
  border-radius: 15px;
  box-shadow: 0 8px 15px rgba(0,0,0,0.2);
  transition: transform 0.3s;
}
#map-room:hover, #map-outlet:hover { transform: scale(1.01); }

/* ----------------- Dropdown Panel ----------------- */
.dropdown-panel {
  position: fixed;
  bottom: -320px;
  left: 0;
  width: 100%;
  max-height: 320px;
  background: rgba(26,26,26,0.95);
  backdrop-filter: blur(6px);
  box-shadow: 0 -6px 20px rgba(0,0,0,0.5);
  border-top: 3px solid #ff2c2c;
  overflow-y: auto;
  color: white;
  transition: bottom 0.4s ease;
  z-index: 999;
  padding: 25px;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
}
.dropdown-panel.show { bottom: 0; }
.dropdown-panel h3 { margin-top:0; color: #ffcc00; text-align: center; font-size:1.3rem; letter-spacing:0.5px; }
.dropdown-panel ul { list-style: none; padding: 0; margin-top: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
.dropdown-panel ul li {
  background: linear-gradient(135deg,#b31b1b,#ff2c2c);
  padding: 12px 18px;
  border-radius: 12px;
  min-width: 130px;
  text-align: center;
  font-weight: bold;
  cursor: default;
  transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
}
.dropdown-panel ul li:hover { background: linear-gradient(135deg,#ff2c2c,#b31b1b); transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.4); }

/* ----------------- Footer ----------------- */
footer {
  text-align: center;
  padding: 20px 0;
  margin-top: 40px;
  background: linear-gradient(90deg,#000,#222);
  color: #fff;
  border-top: 2px solid #b31b1b;
  box-shadow: 0 -3px 10px rgba(0,0,0,0.3);
}
</style>
</head>

<body>
<header>
  <h1>CampusSpace Dashboard</h1>
  <p id="welcomeText"></p>
</header>

<main class="dashboard">
  <h2>What are you looking for?</h2>
  <div class="choice-buttons">
    <button class="btn" onclick="showSection('room')">Find Classroom</button>
    <button class="btn" onclick="showSection('outlet')">Find Outlet</button>
  </div>
</main>

<section id="room-section" style="display:none;">
  <h3 style="text-align:center;">Classroom Locations</h3>
  <div id="map-room"></div>
</section>

<section id="outlet-section" style="display:none;">
  <h3 style="text-align:center;">Outlet Locations</h3>
  <div id="map-outlet"></div>
</section>

<div id="dropdown-panel" class="dropdown-panel">
  <h3 id="panel-title"></h3>
  <ul id="panel-list"></ul>
</div>

<footer>
  <p>© 2025 CampusSpace | Built for students, by students</p>
</footer>

<script>
// --- LOGIN ---
const njitId = localStorage.getItem("njitId");
const welcomeText = document.getElementById("welcomeText");
if (!njitId) window.location.href = "index.html";
else welcomeText.textContent = `Welcome, ${njitId}!`;

// --- Section switch ---
function showSection(type){
  document.getElementById("room-section").style.display = "none";
  document.getElementById("outlet-section").style.display = "none";
  closePanel();

  if(type === "room"){
    document.getElementById("room-section").style.display = "block";
    if(!window.roomMap) initRoomMap();
  } else {
    document.getElementById("outlet-section").style.display = "block";
    if(!window.outletMap) initOutletMap();
  }
}

// Building coordinates
const buildingCoords = {
  "Campus Center":[40.74306293183706,-74.1782790746367],
  "CKB":[40.742077930044374,-74.17761165873084],
  "Tiernan":[40.74211389580971,-74.17960771474273],
  "FMH":[40.74194824823075,-74.17886430626339],
  "ECE":[40.74148403914861,-74.17876516412794],
  "NJIT Bookstore":[40.74122061658114,-74.1780857575864],
  "Fenster":[40.74259903233696,-74.1772116993912],
  "Eberhardt Hall":[40.74282548216093,-74.17710341553955],
  "Cullimore Hall":[40.742999783794815,-74.17736955981962],
  "Kupfrian":[40.742497611819225,-74.17854209440154],
  "NJIT Library":[40.74386467796301,-74.17809100239326],
  "GITC":[40.74427820993796,-74.17930669533548],
  "WEC":[40.74226698922005,-74.1803714183182]
};

// Lists per building
const classroomList = {
  "CKB":["CKB 216","CKB 227"],
  "Cullimore Hall":["Cullimore 204"],
  "Kupfrian":["Kupfrian 110"],
  "Tiernan":["Tiernan 101"]
};
const outletList = {
  "Campus Center":["2nd Floor Lounge","Game Room"],
  "Central King Building":["Hallway Outlet"],
  "GITC":["Atrium Outlet"],
  "Library":["Study Zone Outlet"]
};

// Dropdown panel
function showBuildingInfo(building,type){
  const map = (type==="room")? window.roomMap : window.outletMap;
  map.setView(buildingCoords[building],18);

  const panel = document.getElementById("dropdown-panel");
  const panelTitle = document.getElementById("panel-title");
  const panelList = document.getElementById("panel-list");

  panelTitle.textContent = building;
  panelList.innerHTML = "";
  const items = (type==="room")? (classroomList[building]||[]) : (outletList[building]||[]);
  items.forEach(i=>{
    const li = document.createElement("li");
    li.textContent = i;
    panelList.appendChild(li);
  });

  panel.classList.add("show");
}
function closePanel(){ document.getElementById("dropdown-panel").classList.remove("show"); }

// Initialize maps
function initRoomMap(){
  window.roomMap = L.map("map-room").setView([40.7428,-74.1785],17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom:19, attribution:'© OpenStreetMap'
  }).addTo(window.roomMap);

  Object.entries(buildingCoords).forEach(([name, coord])=>{
    L.marker(coord,{
      icon:L.icon({
        iconUrl:'https://cdn-icons-png.flaticon.com/512/167/167707.png',
        iconSize:[30,30]
      })
    }).addTo(window.roomMap).bindPopup(`<b>${name}</b>`)
      .on("click",()=>showBuildingInfo(name,"room"));
  });
}

// Custom inline SVG plug icon (DivIcon) in blue
function makePlugIcon(size = 35, color = "#1e90ff"){ // Dodger Blue
  const half = Math.round(size/2);
  return L.divIcon({
    html: `
      <svg width="${size}" height="${size}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <!-- Minimal plug: two prongs + body -->
        <g fill="${color}">
          <rect x="6" y="2" width="3" height="7" rx="1.5"></rect>
          <rect x="15" y="2" width="3" height="7" rx="1.5"></rect>
          <rect x="5" y="9" width="14" height="9" rx="3"></rect>
          <!-- Cable nub -->
          <rect x="10.5" y="18" width="3" height="4" rx="1.2"></rect>
        </g>
        <!-- Subtle outline for contrast -->
        <rect x="5" y="9" width="14" height="9" rx="3" fill="none" stroke="#0f3d99" stroke-width="0.8"></rect>
      </svg>
    `,
    className: "plug-icon",
    iconSize: [size, size],
    iconAnchor: [half, size],     // bottom center
    popupAnchor: [0, -size]       // popup above icon
  });
}

function initOutletMap(){
  const outletIcon = makePlugIcon(35, "#1e90ff");

  window.outletMap = L.map("map-outlet").setView([40.7428,-74.1785],17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom:19, attribution:'© OpenStreetMap'
  }).addTo(window.outletMap);

  Object.entries(buildingCoords).forEach(([name, coord])=>{
    L.marker(coord,{ icon: outletIcon })
      .addTo(window.outletMap).bindPopup(`<b>${name}</b>`)
      .on("click",()=>showBuildingInfo(name,"outlet"));
  });
}
</script>
</body>
</html>